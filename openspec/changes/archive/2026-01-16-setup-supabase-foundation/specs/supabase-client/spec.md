# Supabase Client Specification

> Typed Supabase client configuration for database access.

---

## ADDED Requirements

### Requirement: Environment Configuration

The system SHALL use type-safe environment variables for Supabase configuration.

#### Scenario: Required variables defined
- **WHEN** application starts
- **THEN** validate presence of `SUPABASE_URL` and `SUPABASE_ANON_KEY` server variables

#### Scenario: Missing variables fail fast
- **WHEN** required Supabase variables are missing
- **THEN** application fails to start with descriptive error

#### Scenario: Optional service role key
- **WHEN** running administrative operations
- **THEN** optionally use `SUPABASE_SERVICE_ROLE_KEY` for bypassing RLS

---

### Requirement: Client Factory

The system SHALL provide a typed Supabase client factory.

#### Scenario: Server-side client creation
- **WHEN** server code needs database access
- **THEN** use `createServerClient()` from `lib/data/client.ts`

#### Scenario: Client-side client creation
- **WHEN** browser code needs database access
- **THEN** use `createBrowserClient()` from `lib/data/client.ts`

#### Scenario: Type inference from schema
- **WHEN** using Supabase client
- **THEN** TypeScript provides autocomplete for tables and columns

---

### Requirement: Cloudflare Workers Compatibility

The system SHALL work within Cloudflare Workers runtime constraints.

#### Scenario: No Node.js-specific APIs
- **WHEN** client is initialized
- **THEN** use only Web-standard APIs (fetch, crypto, etc.)

#### Scenario: Edge-compatible auth
- **WHEN** handling authentication
- **THEN** use Supabase JS client's built-in cookie handling

---

## Database Schema Types

```typescript
// lib/data/database.types.ts
// Generated by Supabase CLI: supabase gen types typescript

export type Database = {
  public: {
    Tables: {
      // Tables will be added in Phase 1
    }
    Views: {}
    Functions: {}
    Enums: {}
  }
}
```

---

## Client Module Structure

```typescript
// lib/data/client.ts
import { createClient } from '@supabase/supabase-js'
import type { Database } from './database.types'
import { env } from '~/env'

export function createServerClient() {
  return createClient<Database>(
    env.SUPABASE_URL,
    env.SUPABASE_ANON_KEY
  )
}

export function createBrowserClient() {
  return createClient<Database>(
    env.VITE_SUPABASE_URL,
    env.VITE_SUPABASE_ANON_KEY
  )
}
```
